/*!
 *  @its2easy/animate-images 0.1.0
 *  https://github.com/its2easy/animate-images
 *
 *  Copyright (c) 2020 Dmitry Kovalev,
 *  Released under the MIT license
 */
!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define("animateImages",[],a):"object"==typeof exports?exports.animateImages=a():e.animateImages=a()}(this,(function(){return(()=>{"use strict";var e={d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};function t(e,a){return(e=Math.floor(e))<=0?1:e>a?a:e}function n(e){return e.images.length/e.fps*1e3}function i(e=0,{settings:a,data:t}){if(t.load.isPreloadFinished)return;let n=t.totalImages-t.load.preloadOffset;if(e>n&&(e=n),!(e<=0)){for(let n=t.load.preloadOffset;n<e+t.load.preloadOffset;n++){let e=new Image;e.onload=i,e.onerror=i,e.src=a.images[n],t.loadedImagesArray[n]=e}t.load.preloadOffset=t.load.preloadOffset+e}function i(e){t.load.preloadedImagesNumber++;let a=Math.floor(t.load.preloadedImagesNumber/t.totalImages*1e3)/1e3;t.canvas.element.dispatchEvent(new CustomEvent("animate-images:loading-progress",{detail:{progress:a}})),"error"===e.type&&(t.load.isLoadWithErrors=!0,t.canvas.element.dispatchEvent(new Event("animate-images:loading-error"))),t.load.preloadedImagesNumber===t.totalImages&&(t.load.isPreloadFinished=!0,t.load.onLoadFinishedCB())}}function o({settings:e,data:a,drawFrame:t,updateImageSizes:n}){if(e.poster&&!a.isAnyFrameChanged){let i=new Image;function o(o){"error"!==o.type&&(a.poster.isPosterLoaded=!0,a.poster.imageObject=i,a.canvas.element.dispatchEvent(new Event("animate-images:poster-loaded")),"onPosterLoaded"in e&&e.onPosterLoaded(),a.isAnyFrameChanged||(n(i,!1),t(i,{settings:e,data:a})))}i.onload=o,i.onerror=o,i.src=e.poster}}function r(e,{settings:a,data:t}){let n,i,o,r,s,d,l,m,g;n=Number.isInteger(e)?t.loadedImagesArray[e-1]:e,"cover"===a.fillMode?({sx:i,sy:o,sWidth:r,sHeight:s,dx:d,dy:l,dWidth:m,dHeight:g}=function(e,a){let t,n,i,o,r=0,s=0,d=a.canvas.element.width,l=a.canvas.element.height,m=a.canvas.imageWidth,g=a.canvas.imageHeight,p=.5,c=.5,h=Math.min(d/m,l/g),u=m*h,f=g*h,v=1;u<d&&(v=d/u);Math.abs(v-1)<1e-14&&f<l&&(v=l/f);u*=v,f*=v,i=m/(u/d),o=g/(f/l),t=(m-i)*p,n=(g-o)*c,t<0&&(t=0);n<0&&(n=0);i>m&&(i=m);o>g&&(o=g);return{sx:t,sy:n,sWidth:i,sHeight:o,dx:r,dy:s,dWidth:d,dHeight:l}}(0,t)):"contain"===a.fillMode&&({sx:i,sy:o,sWidth:r,sHeight:s,dx:d,dy:l,dWidth:m,dHeight:g}=function(e,a){let t,n,i=a.canvas.element.width,o=a.canvas.element.height,r=a.canvas.imageWidth,s=a.canvas.imageHeight,d=0,l=0,m=r,g=s,p=.5,c=.5,h=i/r,u=o/s,f=Math.min(h,u),v=r*f,y=s*f;return t=(i-v)*p,n=(o-y)*c,{sx:d,sy:l,sWidth:m,sHeight:g,dx:t,dy:n,dWidth:v,dHeight:y}}(0,t)),t.canvas.context.drawImage(n,i,o,r,s,d,l,m,g)}function s(e){e.canvas.context.clearRect(0,0,e.canvas.imageWidth,e.canvas.imageHeight)}function d(e,a={}){!function(e,a){if(!(e instanceof HTMLCanvasElement))throw new TypeError("Node is required and should be canvas element");if(!a.images||!Array.isArray(a.images)||a.images.length<=1)throw new TypeError("options.images is required and must be an array with more than 1 element");if("preload"in a&&("string"!=typeof a.preload||"all"!==a.preload&&"none"!==a.preload&&"partial"!==a.preload))throw new TypeError("options.preload must be one of these: all, none, partial");if("preloadNumber"in a&&!(Number.isInteger(Number.parseInt(a.preloadNumber))&&Number.parseInt(a.preloadNumber)>=0))throw new TypeError("options.preloadNumber must be number >= 0");if(a.preloadNumber=Number.parseInt(a.preloadNumber),"fillMode"in a&&!["cover","contain"].includes(a.fillMode))throw new TypeError('options.fillMode must be "cover" or "contain"')}(e,a);let d={poster:!1,draggable:!1,loop:!1,reverse:!1,autoplay:!1,preload:"all",preloadNumber:0,fps:30,fillMode:"cover",...a},l={currentFrame:1,isAnimating:!1,totalImages:a.images.length,loadedImagesArray:[],deferredAction:null,isAnyFrameChanged:!1,animation:{lastUpdate:0,duration:n(d),framesLeftToPlay:void 0,deltaFrames:1,animationPromise:null,animationPromiseResolve:null,stopRequested:!1},poster:{imageObject:null,isPosterLoaded:!1},load:{isPreloadFinished:!1,preloadOffset:0,preloadedImagesNumber:0,isLoadWithErrors:!1,onLoadFinishedCB:function(){u(l.loadedImagesArray[0],!0),e.dispatchEvent(new Event("animate-images:preload-finished")),"onPreloadFinished"in d&&d.onPreloadFinished(f);l.deferredAction&&l.deferredAction()}},canvas:{element:e,context:null,ratio:null,imageWidth:null,imageHeight:null}};function m(e){e===l.currentFrame&&l.isAnyFrameChanged||(l.isAnyFrameChanged||(l.isAnyFrameChanged=!0),c(e),void 0!==l.animation.framesLeftToPlay&&(l.animation.framesLeftToPlay=l.animation.framesLeftToPlay-l.animation.deltaFrames),l.currentFrame=e)}function g(e){if(void 0!==l.animation.framesLeftToPlay&&l.animation.framesLeftToPlay<=0&&f.stop(),!l.isAnimating)return;const a=(e-l.animation.lastUpdate)/l.animation.duration*l.totalImages;if(a>=1){let t=p(Math.floor(a));l.animation.stopRequested?(f.stop(),l.animation.stopRequested=!1):(l.animation.lastUpdate=e,m(t))}l.isAnimating&&requestAnimationFrame(g)}function p(e,a){e%=l.totalImages,l.animation.deltaFrames=e,void 0===a&&(a=d.reverse);let t=a?l.currentFrame-e:l.currentFrame+e;return d.loop?t<=0?t=l.totalImages-Math.abs(t):t>l.totalImages&&(t-=l.totalImages):t<=0?(t=1,l.animation.stopRequested=!0):t>l.totalImages&&(t=l.totalImages,l.animation.stopRequested=!0),t}function c(e){s(l),r(e,{settings:d,data:l})}function h(){d.ratio?l.canvas.ratio=d.ratio:l.canvas.ratio=l.canvas.element.width/l.canvas.element.height,l.canvas.element.width=l.canvas.element.clientWidth,l.canvas.element.height=l.canvas.element.width/l.canvas.ratio,l.canvas.element.height!==l.canvas.element.clientHeight&&(l.canvas.element.height=l.canvas.element.clientHeight,l.canvas.ratio=l.canvas.element.width/l.canvas.element.height),function({settings:e,data:a}){a.isAnyFrameChanged?c(a.currentFrame):!a.isAnyFrameChanged&&a.poster.imageObject&&r(a.poster.imageObject,{settings:e,data:a})}({settings:d,data:l})}function u(e,a=!1){(a||!l.canvas.imageWidth&&!l.canvas.imageHeight)&&(l.canvas.imageWidth=e.naturalWidth,l.canvas.imageHeight=e.naturalHeight)}let f={play(){if(!l.isAnimating)return l.load.isPreloadFinished?(l.isAnimating=!0,l.isAnyFrameChanged||m(1),l.animation.lastUpdate=performance.now(),requestAnimationFrame(g)):(l.deferredAction=f.play,i(l.totalImages,{settings:d,data:l})),this},stop(){return l.isAnimating&&(e.dispatchEvent(new Event("animate-images:animation-end")),"function"==typeof l.animation.animationPromiseResolve&&l.animation.animationPromiseResolve(this)),l.isAnimating=!1,l.animation.framesLeftToPlay=void 0,l.animation.animationPromise=null,this},togglePlay(){return l.isAnimating?f.stop():f.play(),this},next(){return l.load.isPreloadFinished?(f.stop(),m(p(1))):(l.deferredAction=f.next,i(l.totalImages,{settings:d,data:l})),this},prev(){return l.load.isPreloadFinished?(f.stop(),m(p(1,!d.reverse))):(l.deferredAction=f.prev,i(l.totalImages,{settings:d,data:l})),this},setFrame(e){return l.load.isPreloadFinished?(f.stop(),m(t(e,l.totalImages))):(l.deferredAction=f.setFrame.bind(this,e),i(l.totalImages,{settings:d,data:l})),this},playTo(e){return l.load.isPreloadFinished?((e=t(e,l.totalImages))>l.currentFrame?f.setReverse(!1):f.setReverse(!0),l.animation.animationPromise=f.playFrames(Math.abs(e-l.currentFrame))):(l.deferredAction=f.playTo.bind(this,e),i(l.totalImages,{settings:d,data:l})),l.animation.animationPromise||(l.animation.animationPromise=new Promise(((e,a)=>{l.animation.animationPromiseResolve=e}))),l.animation.animationPromise},playFrames(e=0){if(l.load.isPreloadFinished){if((e=Math.floor(e))<0)return new Promise((e=>{e(this)}));if(l.isAnyFrameChanged||(e+=1),e<=0)return new Promise((e=>{e(this)}));l.animation.framesLeftToPlay=e,f.play()}else l.deferredAction=f.playTo.bind(this,e),i(l.totalImages,{settings:d,data:l});return l.animation.animationPromise||(l.animation.animationPromise=new Promise(((e,a)=>{l.animation.animationPromiseResolve=e}))),l.animation.animationPromise},setReverse(e=!0){return d.reverse=!!e,this},preloadImages(e){var a;return i(e=null!==(a=e)&&void 0!==a?a:l.totalImages,{settings:d,data:l}),this},updateCanvas(){h()},reset(){return l.load.isPreloadFinished?(f.stop(),m(t(1,l.totalImages))):(l.deferredAction=f.reset,i(l.totalImages,{settings:d,data:l})),this},destroy(){var e;f.stop(),s(),e=h,window.removeEventListener("resize",e)},getOption:e=>{if(["fps","draggable","loop","reverse","poster","autoplay","fillMode"].includes(e))return d[e];console.warn(`${e} is not allowed in getOption`)},setOption:(e,a)=>{["fps","draggable","loop","reverse","poster","ratio","fillMode"].includes(e)?(d[e]=a,"poster"===e&&o({settings:d,data:l,drawFrame:r,updateImageSizes:u}),"fps"===e&&(l.animation.duration=n(d)),"ratio"===e&&h(),"fillMode"===e&&h()):console.warn(`${e} is not allowed in setOption`)},getCurrentFrame:()=>l.currentFrame,getTotalImages:()=>l.totalImages,getRatio:()=>l.canvas.ratio,isAnimating:()=>l.isAnimating,isPreloadFinished:()=>l.load.isPreloadFinished,isLoadWithErrors:()=>l.load.isLoadWithErrors,isPosterLoaded:()=>l.poster.isPosterLoaded};return function(){var e;if(l.canvas.context=l.canvas.element.getContext("2d"),h(),l.animation.lastUpdate=performance.now(),o({settings:d,data:l,drawFrame:r,updateImageSizes:u}),e=h,window.addEventListener("resize",e),"all"===d.preload||"partial"===d.preload){let e="all"===d.preload?l.totalImages:d.preloadNumber;0===e&&(e=l.totalImages),i(e,{settings:d,data:l})}d.autoplay&&f.play()}(),f}return e.r(a),e.d(a,{init:()=>d}),a})()}));
//# sourceMappingURL=animate-images.min.js.map